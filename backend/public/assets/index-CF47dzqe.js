(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const l={async getChapter(){try{const o=await(await fetch("/api/random-chapter")).json(),a=document.getElementById("chapter"),t=o.chapter;a.dataset.id=o.chapter.id,a.innerText=`${t.subject}-${t.chapter_no}: ${t.title} (${t.book_type})`}catch(r){console.error("API 요청 실패:",r),document.getElementById("chapter").innerText="데이터를 불러올 수 없습니다."}},async addChapter(r){r.preventDefault();const o=document.getElementById("subjectInput").value.trim(),a=document.getElementById("chapterNoInput").value.trim(),t=document.getElementById("titleInput").value.trim(),e=document.getElementById("book_type").value.trim();if(!o||!a||!t||a<=0||!e){alert("모든 필드를 올바르게 입력하세요.");return}try{const n=await fetch("/api/add-chapter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:o,chapter_no:a,title:t,book_type:e})}),d=await n.json();n.ok?(alert("새로운 챕터가 추가되었습니다!"),document.getElementById("subjectInput").value="",document.getElementById("chapterNoInput").value="",document.getElementById("titleInput").value=""):alert("챕터 추가 실패: "+d.error)}catch(n){console.error("챕터 추가 중 오류 발생:",n),alert("서버 오류로 챕터를 추가할 수 없습니다.")}},async markAsStudied(){const r=document.getElementById("chapter").dataset.id;if(!r)return alert("선택된 챕터가 없습니다.");try{const a=await(await fetch("/api/mark-as-studied",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r})})).json();alert(a.message),getChapter()}catch(o){console.error("학습 완료 실패:",o)}},async loadChapters(){try{const o=await(await fetch("/api/chapters")).json(),a=document.getElementById("chapterList");a.innerHTML="",o.chapters.forEach(t=>{const e=document.createElement("tr");let n=t.review_count,d=n===0?"bg-gray-50":`bg-blue-${Math.min(100+n*100,900)}`;e.classList.add(d,"text-gray-800");const s=document.createElement("td");s.classList.add("p-4","border");const i=document.createElement("span");i.innerText=t.subject,i.classList.add("hidden","sm:inline");const p=document.createElement("span");p.innerText=t.subject.slice(0,2),p.classList.add("inline","sm:hidden"),s.appendChild(i),s.appendChild(p),e.appendChild(s);const u=document.createElement("td");u.innerText=t.chapter_no,u.classList.add("p-4","border","hidden","sm:table-cell"),e.appendChild(u);const m=document.createElement("td");m.innerText=t.title,m.classList.add("p-4","border"),e.appendChild(m);const c=document.createElement("td");c.classList.add("p-4","border");const h=document.createElement("span");h.innerText=t.book_type,h.classList.add("hidden","sm:inline");const y=document.createElement("span");y.innerText=t.book_type.charAt(0),y.classList.add("inline","sm:hidden","px-2","py-1","text-xs","font-semibold","rounded-full","bg-blue-100","text-blue-600"),c.appendChild(h),c.appendChild(y),e.appendChild(c);const f=document.createElement("td");f.innerText=t.review_count,f.classList.add("p-4","border","hidden","sm:table-cell"),e.appendChild(f);const b=document.createElement("td");b.innerText=t.last_reviewed?new Date(t.last_reviewed).toLocaleDateString():"-",b.classList.add("p-4","border","hidden","sm:table-cell"),e.appendChild(b),a.appendChild(e)})}catch(r){console.error("챕터 목록 불러오기 실패:",r)}}};Object.keys(l).forEach(r=>{window[r]=l[r]});document.getElementById("addChapterForm").addEventListener("submit",addChapter);document.getElementById("refreshButton").addEventListener("click",loadChapters);l.getChapter();l.loadChapters();
