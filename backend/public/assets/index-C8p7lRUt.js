(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function n(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(e){if(e.ep)return;e.ep=!0;const r=n(e);fetch(e.href,r)}})();const s={async getChapter(){try{const o=await(await fetch("/api/random-chapter")).json(),n=document.getElementById("chapter"),t=o.chapter;n.dataset.id=o.chapter.id,n.innerText=`${t.subject}-${t.chapter_no}: ${t.title} (${t.book_type})`}catch(a){console.error("API 요청 실패:",a),document.getElementById("chapter").innerText="데이터를 불러올 수 없습니다."}},async addChapter(a){a.preventDefault();const o=document.getElementById("subjectInput").value.trim(),n=document.getElementById("chapterNoInput").value.trim(),t=document.getElementById("titleInput").value.trim(),e=document.getElementById("book_type").value.trim();if(!o||!n||!t||n<=0||!e){alert("모든 필드를 올바르게 입력하세요.");return}try{const r=await fetch("/api/add-chapter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:o,chapter_no:n,title:t,book_type:e})}),c=await r.json();r.ok?(alert("새로운 챕터가 추가되었습니다!"),document.getElementById("subjectInput").value="",document.getElementById("chapterNoInput").value="",document.getElementById("titleInput").value=""):alert("챕터 추가 실패: "+c.error)}catch(r){console.error("챕터 추가 중 오류 발생:",r),alert("서버 오류로 챕터를 추가할 수 없습니다.")}},async markAsStudied(){function a(n,t="blue"){const e=document.createElement("div");e.className=`p-4 mb-4 text-sm text-${t}-800 bg-${t}-100 rounded-lg flex justify-between items-center`,e.innerHTML=`
                <span>${n}</span>
                <button onclick="this.parentElement.remove()" class="ml-4 text-${t}-800 hover:text-${t}-900">✖</button>
            `,document.body.prepend(e)}const o=document.getElementById("chapter").dataset.id;if(!o)return alert("선택된 챕터가 없습니다.");try{const t=await(await fetch("/api/mark-as-studied",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o})})).json();a(t.message),getChapter()}catch(n){console.error("학습 완료 실패:",n)}},async loadChapters(){try{const o=await(await fetch("/api/chapters")).json(),n=document.getElementById("chapterList");n.innerHTML="",o.chapters.forEach(t=>{const e=document.createElement("tr");let r=t.review_count,c=r===0?"bg-gray-50":`bg-blue-${Math.min(100+r*100,900)}`;e.classList.add(c,"text-gray-800");const d=document.createElement("td");d.innerText=t.subject,d.classList.add("p-4","border"),e.appendChild(d);const i=document.createElement("td");i.innerText=t.chapter_no,i.classList.add("p-4","border"),e.appendChild(i);const l=document.createElement("td");l.innerText=t.title,l.classList.add("p-4","border"),e.appendChild(l);const u=document.createElement("td");u.innerText=t.book_type,u.classList.add("p-4","border"),e.appendChild(u);const p=document.createElement("td");p.innerText=t.review_count,p.classList.add("p-4","border"),e.appendChild(p);const m=document.createElement("td");m.innerText=t.last_reviewed?new Date(t.last_reviewed).toLocaleDateString():"-",m.classList.add("p-4","border"),e.appendChild(m),n.appendChild(e)})}catch(a){console.error("챕터 목록 불러오기 실패:",a)}}};Object.keys(s).forEach(a=>{window[a]=s[a]});document.getElementById("addChapterForm").addEventListener("submit",addChapter);document.getElementById("refreshButton").addEventListener("click",loadChapters);s.getChapter();s.loadChapters();
